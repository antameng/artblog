"use strict";(self["webpackChunkblog"]=self["webpackChunkblog"]||[]).push([[831],{75831:(e,t,l)=>{l.r(t),l.d(t,{default:()=>Ce});var o=l(83673),n=l(62323);const a={class:"row justify-center"},i={key:0,style:{position:"fixed","margin-left":"-5rem",top:"140px","z-index":"2"}},s={key:1,class:"q-mb-lg"},r={class:"text-cyan-9",style:{"margin-top":"10px"}},m=["src"],c={class:"text-italic"},d={key:2,class:"q-mb-lg"},u=(0,o._)("div",{class:"text-h6"},"目录",-1),p=["onClick"],g={style:{cursor:"pointer"}};function w(e,t,l,w,f,h){const x=(0,o.up)("q-btn"),v=(0,o.up)("q-avatar"),y=(0,o.up)("q-item-section"),C=(0,o.up)("q-item-label"),_=(0,o.up)("q-icon"),k=(0,o.up)("q-item"),b=(0,o.up)("q-skeleton"),W=(0,o.up)("q-scroll-observer"),q=(0,o.up)("v-md-preview"),D=(0,o.up)("q-chip"),Z=(0,o.up)("q-separator"),A=(0,o.up)("Comment"),Q=(0,o.up)("q-page"),z=(0,o.up)("q-card-section"),I=(0,o.up)("q-card");return(0,o.wg)(),(0,o.iD)("div",a,[(0,o.Wm)(Q,{padding:"",class:"col-xs-12",style:{width:"750px"}},{default:(0,o.w5)((()=>[e.$q.screen.gt.sm?((0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("div",null,[(0,o.Wm)(x,{style:{"margin-bottom":"1.667rem"},round:"",color:"primary",icon:"thumb_up_alt"})]),(0,o._)("div",null,[(0,o.Wm)(x,{style:{"margin-bottom":"1.667rem"},round:"",color:"primary",icon:"star"})])])):(0,o.kq)("",!0),e.onload?((0,o.wg)(),(0,o.iD)("div",s,[(0,o._)("h4",r,(0,n.zw)(e.post.title),1),(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{onClick:t[0]||(t[0]=t=>e.toRepositories(e.post.profile.id)),round:""},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o._)("img",{src:e.post.profile.avatar},null,8,m)])),_:1})])),_:1})])),_:1}),(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(C,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.post.profile.name),1)])),_:1}),(0,o.Wm)(C,null,{default:(0,o.w5)((()=>[(0,o._)("code",c," Updated by "+(0,n.zw)(e.$store.getters.username)+" "+(0,n.zw)(e.post.CreatedAt),1),(0,o.Wm)(_,{style:{"padding-left":"15px"},name:"visibility"}),(0,o.Uk)(" "+(0,n.zw)(e.post.viewCount),1)])),_:1})])),_:1})])),_:1})])):((0,o.wg)(),(0,o.iD)("div",d,[(0,o.Wm)(b,{width:"50%"}),(0,o.Wm)(b,{type:"text",width:"30%"})])),(0,o.Wm)(W,{onScroll:w.onScroll},null,8,["onScroll"]),(0,o.Wm)(q,{text:e.post.content,ref:"previewRef"},null,8,["text"]),(0,o._)("div",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.post.labels,(t=>((0,o.wg)(),(0,o.j4)(D,{outline:"",square:"",clickable:"",class:"label",key:t.index,style:(0,n.j5)(`border-color: #${t.color}; color: #${t.color};`),onClick:l=>e.chipClickHandler(t.name)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(t.name),1)])),_:2},1032,["style","onClick"])))),128))]),(0,o.Wm)(Z,{color:"cyan-9",style:{height:"1px"}}),(0,o.Wm)(A,{idss:e.post.id},null,8,["idss"])])),_:1}),e.$q.screen.gt.sm?((0,o.wg)(),(0,o.j4)(Q,{key:0,style:{width:"250px",padding:"16px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(I,{style:{position:"fixed",width:"218px",top:"inherit","z-index":"2"},flat:"",bordered:"",class:"my-card"},{default:(0,o.w5)((()=>[(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[u])),_:1}),(0,o.Wm)(Z,{inset:""}),(0,o.Wm)(z,{ref:"titleRef"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.titles,((t,l)=>((0,o.wg)(),(0,o.iD)("div",{class:(0,n.C_)(`line${t.lineIndex}`),key:l,style:(0,n.j5)({padding:`10px 0 10px ${20*t.indent}px`}),onClick:l=>e.handleAnchorClick(t)},[(0,o._)("a",g,(0,n.zw)(t.title),1)],14,p)))),128))])),_:1},512)])),_:1})])),_:1})):(0,o.kq)("",!0)])}var f=l(61959);const h=["src"],x={class:"q-gutter-sm",style:{"margin-top":"0px"}},v=["onClick"],y={class:"text-bold"},C=(0,o.Uk)(" to join this conversation on GitHub. Already have an account? "),_=(0,o.Uk)("Sign in to comment"),k=["src"],b={class:"text-weight-bold"},W={class:"text-gray-light"},q={class:"q-gutter-sm"},D={key:0},Z=["src"],A={class:"q-gutter-sm",style:{"margin-top":"0px"}},Q=["onClick"],z=["src"],I={class:"text-weight-bold"},S=(0,o._)("span",{class:"text-weight-bold"}," 回复：",-1),H={class:"text-gray-light"},Y={class:"q-gutter-sm"},j={key:0},P=["src"],T={class:"q-gutter-sm",style:{"margin-top":"0px"}},$=["onClick"],L=(0,o._)("div",{class:"q-pa-md q-gutter-sm"},null,-1);function E(e,t,l,a,i,s){const r=(0,o.up)("q-avatar"),m=(0,o.up)("q-popup-edit"),c=(0,o.up)("q-btn"),d=(0,o.up)("q-input"),u=(0,o.up)("router-link"),p=(0,o.up)("q-card-section"),g=(0,o.up)("q-card"),w=(0,o.up)("q-item-section"),f=(0,o.up)("q-item-label"),E=(0,o.up)("q-badge"),U=(0,o.up)("q-item"),M=(0,o.up)("q-list");return(0,o.wg)(),(0,o.iD)("div",null,[e.logged?((0,o.wg)(),(0,o.j4)(d,{key:0,autogrow:"",modelValue:e.text,"onUpdate:modelValue":t[1]||(t[1]=t=>e.text=t),label:"Comment",dense:e.dense},{before:(0,o.w5)((()=>[(0,o.Wm)(r,{rounded:""},{default:(0,o.w5)((()=>[(0,o._)("img",{src:e.meinfo.avatar},null,8,h)])),_:1})])),after:(0,o.w5)((()=>[(0,o.Wm)(c,{flat:"",round:"",color:"primary",icon:"mood"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{"max-width":"250px",style:{padding:"4px 8px"},self:"top start",cover:"false"},{default:(0,o.w5)((()=>[(0,o._)("div",x,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.faceList,((t,l)=>((0,o.wg)(),(0,o.iD)("a",{href:"javascript:void(0);",onClick:t=>e.getEmo(l),style:{"font-size":"22px","texttext-decoration":"none"},key:l,class:"emotionItem"},(0,n.zw)(t),9,v)))),128))])])),_:1})])),_:1}),(0,o.Wm)(c,{flat:"",color:"primary",class:"text-weight-bolder",onClick:t[0]||(t[0]=t=>e.addComment(0)),label:"comment"})])),_:1},8,["modelValue","dense"])):((0,o.wg)(),(0,o.j4)(g,{key:1,class:"bg-primary text-white"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o._)("div",y,[(0,o.Wm)(c,{push:"",color:"white",to:"/signup","text-color":"black",label:"Sign up for free"}),C,(0,o.Wm)(u,{class:"text-yellow-8 text-weight-bold",to:"/login",style:{color:"#fff"}},{default:(0,o.w5)((()=>[_])),_:1})])])),_:1})])),_:1})),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.comments,((l,a)=>((0,o.wg)(),(0,o.j4)(M,{bordered:"",class:"rounded-borders q-mt-lg",key:a},{default:(0,o.w5)((()=>[(0,o.Wm)(U,{class:"q-pa-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"cursor-pointer",onClick:t=>e.toRepositories(l.FromProfile.id),rounded:""},{default:(0,o.w5)((()=>[(0,o._)("img",{alt:"avatar",src:l.FromProfile.avatar},null,8,k)])),_:2},1032,["onClick"])])),_:2},1024),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{lines:"1"},{default:(0,o.w5)((()=>[(0,o._)("span",b,(0,n.zw)(l.FromProfile.name)+"　",1),(0,o._)("span",W,(0,n.zw)(l.CreatedAt),1)])),_:2},1024),(0,o.Wm)(f,{style:{"word-break":"break-all"},innerHTML:l.content,class:"q-pt-sm"},null,8,["innerHTML"])])),_:2},1024),(0,o._)("div",q,[e.logged?((0,o.wg)(),(0,o.j4)(c,{key:0,size:"10px",round:"",flat:"",color:"primary",icon:"comment",onClick:t=>e.commentss(a,null)},null,8,["onClick"])):(0,o.kq)("",!0),(0,o.Wm)(c,{size:"10px",round:"",flat:"",color:0==l.DiggArr.length?"#ccc":"red",icon:"favorite",onClick:t=>e.favorite(a,null,l.ID)},{default:(0,o.w5)((()=>[(0,o.Wm)(E,{color:0==l.DiggArr.length?"#ccc":"orange",rounded:"",floating:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(l.digg),1)])),_:2},1032,["color"])])),_:2},1032,["color","onClick"])])])),_:2},1024),l.isshow?((0,o.wg)(),(0,o.iD)("div",D,[(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{rounded:""},{default:(0,o.w5)((()=>[(0,o._)("img",{src:e.meinfo.avatar},null,8,Z)])),_:1})])),_:1}),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{autogrow:"",modelValue:e.childtext,"onUpdate:modelValue":t[2]||(t[2]=t=>e.childtext=t),label:"回复："+l.FromProfile.name,dense:e.dense},{after:(0,o.w5)((()=>[(0,o.Wm)(c,{flat:"",round:"",color:"primary",icon:"mood"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{"max-width":"250px",style:{padding:"4px 8px"},self:"top start",cover:"false"},{default:(0,o.w5)((()=>[(0,o._)("div",A,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.faceList,((t,l)=>((0,o.wg)(),(0,o.iD)("a",{href:"javascript:void(0);",onClick:t=>e.getEmo1(l),style:{"font-size":"22px","text-decoration":"none"},key:l,class:"emotionItem"},(0,n.zw)(t),9,Q)))),128))])])),_:1})])),_:1}),(0,o.Wm)(c,{flat:"",class:"text-weight-bolder",color:"primary",onClick:t=>e.addComment(l.ID),label:"Comment"},null,8,["onClick"])])),_:2},1032,["modelValue","label","dense"])])),_:2},1024)])),_:2},1024)])):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.CommentChild,((l,i)=>((0,o.wg)(),(0,o.j4)(M,{class:"q-mx-lg",key:i},{default:(0,o.w5)((()=>[(0,o.Wm)(U,{class:"q-pa-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"cursor-pointer",onClick:t=>e.toRepositories(l.FromProfile.id),rounded:""},{default:(0,o.w5)((()=>[(0,o._)("img",{alt:"avatar",src:l.FromProfile.avatar},null,8,z)])),_:2},1032,["onClick"])])),_:2},1024),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{lines:"1"},{default:(0,o.w5)((()=>[(0,o._)("span",I,(0,n.zw)(l.FromProfile.name),1),S,(0,o._)("span",H,(0,n.zw)(l.ToProfile.name),1)])),_:2},1024),(0,o.Wm)(f,{style:{"word-break":"break-all"},innerHTML:l.content},null,8,["innerHTML"])])),_:2},1024),(0,o._)("div",Y,[e.logged?((0,o.wg)(),(0,o.j4)(c,{key:0,size:"10px",round:"",flat:"",color:"primary",icon:"comment",onClick:t=>e.commentss(a,i)},null,8,["onClick"])):(0,o.kq)("",!0),(0,o.Wm)(c,{size:"10px",round:"",flat:"",color:0==l.DiggArr.length?"#ccc":"red",icon:"favorite",onClick:t=>e.favorite(a,i,l.ID)},{default:(0,o.w5)((()=>[(0,o.Wm)(E,{color:0==l.DiggArr.length?"#ccc":"orange",rounded:"",floating:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(l.digg),1)])),_:2},1032,["color"])])),_:2},1032,["color","onClick"])])])),_:2},1024),l.isshow?((0,o.wg)(),(0,o.iD)("div",j,[(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{rounded:""},{default:(0,o.w5)((()=>[(0,o._)("img",{src:e.meinfo.avatar},null,8,P)])),_:1})])),_:1}),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{autogrow:"",modelValue:e.childtext,"onUpdate:modelValue":t[3]||(t[3]=t=>e.childtext=t),label:"回复："+l.ToProfile.name,dense:e.dense},{after:(0,o.w5)((()=>[(0,o.Wm)(c,{flat:"",round:"",color:"primary",icon:"mood"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{"max-width":"250px",style:{padding:"4px 8px"},self:"top start",cover:"false"},{default:(0,o.w5)((()=>[(0,o._)("div",T,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.faceList,((t,l)=>((0,o.wg)(),(0,o.iD)("a",{href:"javascript:void(0);",onClick:t=>e.getEmo1(l),style:{"font-size":"22px","text-decoration":"none"},key:l,class:"emotionItem"},(0,n.zw)(t),9,$)))),128))])])),_:2},1024)])),_:2},1024),(0,o.Wm)(c,{flat:"",color:"primary",class:"text-weight-bolder",onClick:t=>e.addComment(l.ID),label:"Comment"},null,8,["onClick"])])),_:2},1032,["modelValue","label","dense"])])),_:2},1024)])),_:2},1024)])):(0,o.kq)("",!0)])),_:2},1024)))),128))])),_:2},1024)))),128)),L])}var U=l(78114),M=l(80589),K=l(64434),R=l(21082),V=l(10011),F=l(43359),B=l(79582);const N={name:"Comment",components:{},props:{idss:{type:String,required:!0}},setup(){let e=(0,f.qj)({meinfo:{},logged:!1,marktext:"",faceList:[],text:"",childtext:"",isshow:!1,isfav:!1,isshowindex:0,isshowindex1:0,comments:[]});const t=(0,B.yj)(),l=(0,B.tv)(),n={commentss(t,l){e.childtext="",null==l?(0!=e.comments[e.isshowindex].CommentChild.length&&(e.comments[e.isshowindex].CommentChild[e.isshowindex1].isshow=!1),e.comments[e.isshowindex].isshow=!1,e.comments[t].isshow=!0,e.isshowindex=t):(e.comments[e.isshowindex].CommentChild[e.isshowindex1].isshow=!1,e.comments[e.isshowindex].isshow=!1,e.comments[t].CommentChild[l].isshow=!0,e.isshowindex=t,e.isshowindex1=l)},toRepositories(e){l.push(`/repository/${e}`)},async favorite(t,l,o){const n={comment_id:o};if(null==l)if(0==e.comments[t].DiggArr.length){let l=await(0,V.sh)(n);200==l.status&&(e.comments[t].DiggArr[0]=!0,e.comments[t].digg++)}else{let l=await(0,V.uc)(n);200==l.status&&(e.comments[t].DiggArr=[],e.comments[t].digg--)}else if(0==e.comments[t].CommentChild[l].DiggArr.length){let o=await(0,V.sh)(n);200==o.status&&(e.comments[t].CommentChild[l].DiggArr[0]=!0,e.comments[t].CommentChild[l].digg++)}else{let o=await(0,V.uc)(n);200==o.status&&(e.comments[t].CommentChild[l].DiggArr=[],e.comments[t].CommentChild[l].digg--)}},async getTalk(){"yes"===M.Z.getItem("logged_in")&&(e.logged=!0);const l={pagenum:1,pagesize:10};let o=await(0,F.nQ)(t.params.id,l);null!=o.data&&(e.comments=o.data.map((e=>{e.isshow=!1;let t=new Date(e.CreatedAt),l=R.ZP.formatDate(t,"YYYY-MM-DD HH:mm:ss");e.CreatedAt=l;const o=e.CommentChild;return null!=o&&0!=o.length&&o.forEach((e=>{e.isshow=!1;let t=new Date(e.CreatedAt),l=R.ZP.formatDate(t,"YYYY-MM-DD HH:mm:ss");e.CreatedAt=l})),e})))},async addComment(l){let o={article_id:1e3*t.params.id/1e3,content:e.text,comment_id:0};if(0!=l?(o.content=e.childtext,o.comment_id=l):delete o.comment_id,""==o.content)return void K.Z.create({message:"comment can't be empty",color:"negative",icon:"report_problem",position:"top",timeout:2e3});let a=await(0,V.Ir)(o);200==a.status&&(e.text="",e.childtext=""),await n.getTalk()},getEmo(t){const l=e.faceList[t];e.text=e.text+l},getEmo1(t){const l=e.faceList[t];e.childtext=e.childtext+l},async getEmo2(){}};return(0,o.bv)((async()=>{e.meinfo.avatar=M.Z.getItem("avatar"),await n.getTalk(),U.forEach((t=>{e.faceList.push(t.char)}))})),{...(0,f.BK)(e),...n}}};var O=l(74260),G=l(64689),J=l(75096),X=l(2165),ee=l(61289),te=l(83944),le=l(10151),oe=l(25589),ne=l(27011),ae=l(83414),ie=l(52035),se=l(2350),re=l(69721),me=l(24554),ce=l(7518),de=l.n(ce);const ue=(0,O.Z)(N,[["render",E]]),pe=ue;de()(N,"components",{QInput:G.Z,QAvatar:J.Z,QBtn:X.Z,QPopupEdit:ee.Z,QPopupProxy:te.Z,QCard:le.Z,QCardSection:oe.Z,QList:ne.Z,QItem:ae.Z,QItemSection:ie.Z,QItemLabel:se.Z,QBadge:re.Z,QIcon:me.Z});const ge={name:"Post",components:{Comment:pe},setup(){const e=(0,B.yj)(),t=(0,B.tv)();let l=(0,f.qj)({onload:!1,post:{id:"",title:"",CreatedAt:"",viewCount:"",content:"",profile:null},titles:[],isActive:!0,closetitle:null});const n=(0,f.iH)(null),a=(0,f.iH)(null),i={async commentss(){let t=await(0,V.fq)(e.params.id);l.onload=!0,l.post.content=t.data.content,l.post.id=t.data.ID,l.post.title=t.data.title;let o=new Date(t.data.CreatedAt),n=R.ZP.formatDate(o,"YYYY-MM-DD HH:mm:ss");l.post.CreatedAt=n,l.post.viewCount=t.data.view_count,l.post.profile=t.data.Profile},toRepositories(e){t.push(`/repository/${e}`)},handleAnchorClick(e){const{lineIndex:t}=e,l=n.value.$el.querySelector(`[data-v-md-line="${String(t)}"]`);l&&n.value.scrollToTarget({target:l,scrollContainer:window,top:60})},processTitles(){const e=n.value.$el.querySelectorAll("h1,h2,h3,h4,h5,h6"),t=Array.from(e).filter((e=>!!e.innerText.trim()));if(!t.length)return void(l.titles=[]);const o=Array.from(new Set(t.map((e=>e.tagName)))).sort();l.titles=t.map((e=>({title:e.innerText,lineIndex:e.getAttribute("data-v-md-line"),indent:o.indexOf(e.tagName),top:e.offsetTop}))),console.log(l.titles)}};return(0,o.bv)((async()=>{await i.commentss(),await(0,o.Y3)((()=>{let e=0;const t=n.value.$el.querySelectorAll("img");console.log(t),t.forEach((l=>{l.complete?(e++,e===t.length&&i.processTitles()):(l.addEventListener("load",(()=>{e++,e===t.length&&i.processTitles()})),l.addEventListener("error",(()=>{console.error("图片加载失败:",l.src),e++,e===t.length&&i.processTitles()})))})),t.length||i.processTitles()}))})),{...(0,f.BK)(l),...i,previewRef:n,titleRef:a,onScroll(e){var t=Number(e.position.top)+12;if(l.titles.forEach((e=>{const o=a.value.$el.querySelector(`.line${String(e.lineIndex)}`);o.style.backgroundColor="",t>=e.top&&(l.closetitle=e)})),l.closetitle){const e=a.value.$el.querySelector(`.line${String(l.closetitle.lineIndex)}`);e.style.backgroundColor="#d2eaf9"}}}}};var we=l(24379),fe=l(54103),he=l(4303),xe=l(67030),ve=l(65869);const ye=(0,O.Z)(ge,[["render",w]]),Ce=ye;de()(ge,"components",{QPage:we.Z,QBtn:X.Z,QItem:ae.Z,QItemSection:ie.Z,QAvatar:J.Z,QItemLabel:se.Z,QIcon:me.Z,QSkeleton:fe.ZP,QScrollObserver:he.Z,QChip:xe.Z,QSeparator:ve.Z,QCard:le.Z,QCardSection:oe.Z})}}]);