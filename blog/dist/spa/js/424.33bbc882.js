"use strict";(self["webpackChunkblog"]=self["webpackChunkblog"]||[]).push([[424],{10424:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ye});var l=o(83673),a=o(62323);const n={class:"row justify-center"},i={key:0,style:{position:"fixed","margin-left":"-5rem",top:"140px","z-index":"2"}},s={key:1,class:"q-mb-lg"},r={class:"text-cyan-9",style:{"margin-top":"10px"}},c=["src"],d={class:"text-italic"},m={key:2,class:"q-mb-lg"},u=(0,l._)("div",{class:"text-h6"},"目录",-1),p=["onClick"],g={style:{cursor:"pointer"}};function w(e,t,o,w,f,h){const v=(0,l.up)("q-badge"),x=(0,l.up)("q-btn"),_=(0,l.up)("q-avatar"),y=(0,l.up)("q-item-section"),C=(0,l.up)("q-item-label"),k=(0,l.up)("q-icon"),b=(0,l.up)("q-item"),W=(0,l.up)("q-skeleton"),q=(0,l.up)("q-scroll-observer"),D=(0,l.up)("v-md-preview"),A=(0,l.up)("q-chip"),Z=(0,l.up)("q-separator"),Q=(0,l.up)("Comment"),z=(0,l.up)("q-page"),I=(0,l.up)("q-card-section"),S=(0,l.up)("q-card");return(0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(z,{padding:"",class:"col-xs-12",style:{width:"750px"}},{default:(0,l.w5)((()=>[e.$q.screen.gt.sm?((0,l.wg)(),(0,l.iD)("div",i,[(0,l._)("div",null,[(0,l.Wm)(x,{style:{"margin-bottom":"1.667rem"},round:"",color:"primary",onClick:t[0]||(t[0]=t=>e.favorite()),icon:"thumb_up_alt"},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{color:0==e.post.FavourArr.length?"#ccc":"orange",rounded:"",floating:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.post.favour),1)])),_:1},8,["color"])])),_:1})])])):(0,l.kq)("",!0),e.onload?((0,l.wg)(),(0,l.iD)("div",s,[(0,l._)("h4",r,(0,a.zw)(e.post.title),1),(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(y,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{onClick:t[1]||(t[1]=t=>e.toRepositories(e.post.profile.id)),round:""},{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.post.profile.avatar},null,8,c)])),_:1})])),_:1})])),_:1}),(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(C,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.post.profile.name),1)])),_:1}),(0,l.Wm)(C,null,{default:(0,l.w5)((()=>[(0,l._)("code",d," Updated by "+(0,a.zw)(e.$store.getters.username)+" "+(0,a.zw)(e.post.CreatedAt),1),(0,l.Wm)(k,{style:{"padding-left":"15px"},name:"visibility"}),(0,l.Uk)(" "+(0,a.zw)(e.post.viewCount),1)])),_:1})])),_:1})])),_:1})])):((0,l.wg)(),(0,l.iD)("div",m,[(0,l.Wm)(W,{width:"50%"}),(0,l.Wm)(W,{type:"text",width:"30%"})])),(0,l.Wm)(q,{onScroll:w.onScroll},null,8,["onScroll"]),(0,l.Wm)(D,{text:e.post.content,ref:"previewRef"},null,8,["text"]),(0,l._)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.post.labels,(t=>((0,l.wg)(),(0,l.j4)(A,{outline:"",square:"",clickable:"",class:"label",key:t.index,style:(0,a.j5)(`border-color: #${t.color}; color: #${t.color};`),onClick:o=>e.chipClickHandler(t.name)},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t.name),1)])),_:2},1032,["style","onClick"])))),128))]),(0,l.Wm)(Z,{color:"cyan-9",style:{height:"1px"}}),(0,l.Wm)(Q,{idss:e.post.id},null,8,["idss"])])),_:1}),e.$q.screen.gt.sm?((0,l.wg)(),(0,l.j4)(z,{key:0,style:{width:"250px",padding:"16px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{style:{position:"fixed",width:"218px",top:"inherit","z-index":"2"},flat:"",bordered:"",class:"my-card"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,null,{default:(0,l.w5)((()=>[u])),_:1}),(0,l.Wm)(Z,{inset:""}),(0,l.Wm)(I,{ref:"titleRef"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.titles,((t,o)=>((0,l.wg)(),(0,l.iD)("div",{class:(0,a.C_)(`line${t.lineIndex}`),key:o,style:(0,a.j5)({padding:`10px 0 10px ${20*t.indent}px`}),onClick:o=>e.handleAnchorClick(t)},[(0,l._)("a",g,(0,a.zw)(t.title),1)],14,p)))),128))])),_:1},512)])),_:1})])),_:1})):(0,l.kq)("",!0)])}var f=o(61959);const h=["src"],v={class:"q-gutter-sm",style:{"margin-top":"0px"}},x=["onClick"],_={class:"text-bold"},y=(0,l.Uk)(" to join this conversation on GitHub. Already have an account? "),C=(0,l.Uk)("Sign in to comment"),k=["src"],b={class:"text-weight-bold"},W={class:"text-gray-light"},q={class:"q-gutter-sm"},D={key:0},A=["src"],Z={class:"q-gutter-sm",style:{"margin-top":"0px"}},Q=["onClick"],z=["src"],I={class:"text-weight-bold"},S=(0,l._)("span",{class:"text-weight-bold"}," 回复：",-1),H={class:"text-gray-light"},Y={class:"q-gutter-sm"},j={key:0},P=["src"],T={class:"q-gutter-sm",style:{"margin-top":"0px"}},$=["onClick"],L=(0,l._)("div",{class:"q-pa-md q-gutter-sm"},null,-1);function F(e,t,o,n,i,s){const r=(0,l.up)("q-avatar"),c=(0,l.up)("q-popup-edit"),d=(0,l.up)("q-btn"),m=(0,l.up)("q-input"),u=(0,l.up)("router-link"),p=(0,l.up)("q-card-section"),g=(0,l.up)("q-card"),w=(0,l.up)("q-item-section"),f=(0,l.up)("q-item-label"),F=(0,l.up)("q-badge"),E=(0,l.up)("q-item"),U=(0,l.up)("q-list");return(0,l.wg)(),(0,l.iD)("div",null,[e.logged?((0,l.wg)(),(0,l.j4)(m,{key:0,autogrow:"",modelValue:e.text,"onUpdate:modelValue":t[1]||(t[1]=t=>e.text=t),label:"Comment",dense:e.dense},{before:(0,l.w5)((()=>[(0,l.Wm)(r,{rounded:""},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.meinfo.avatar},null,8,h)])),_:1})])),after:(0,l.w5)((()=>[(0,l.Wm)(d,{flat:"",round:"",color:"primary",icon:"mood"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{"max-width":"250px",style:{padding:"4px 8px"},self:"top start",cover:"false"},{default:(0,l.w5)((()=>[(0,l._)("div",v,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.faceList,((t,o)=>((0,l.wg)(),(0,l.iD)("a",{href:"javascript:void(0);",onClick:t=>e.getEmo(o),style:{"font-size":"22px","texttext-decoration":"none"},key:o,class:"emotionItem"},(0,a.zw)(t),9,x)))),128))])])),_:1})])),_:1}),(0,l.Wm)(d,{flat:"",color:"primary",class:"text-weight-bolder",onClick:t[0]||(t[0]=t=>e.addComment(0)),label:"comment"})])),_:1},8,["modelValue","dense"])):((0,l.wg)(),(0,l.j4)(g,{key:1,class:"bg-primary text-white"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,null,{default:(0,l.w5)((()=>[(0,l._)("div",_,[(0,l.Wm)(d,{push:"",color:"white",to:"/signup","text-color":"black",label:"Sign up for free"}),y,(0,l.Wm)(u,{class:"text-yellow-8 text-weight-bold",to:"/login",style:{color:"#fff"}},{default:(0,l.w5)((()=>[C])),_:1})])])),_:1})])),_:1})),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.comments,((o,n)=>((0,l.wg)(),(0,l.j4)(U,{bordered:"",class:"rounded-borders q-mt-lg",key:n},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{class:"q-pa-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{class:"cursor-pointer",onClick:t=>e.toRepositories(o.FromProfile.id),rounded:""},{default:(0,l.w5)((()=>[(0,l._)("img",{alt:"avatar",src:o.FromProfile.avatar},null,8,k)])),_:2},1032,["onClick"])])),_:2},1024),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(f,{lines:"1"},{default:(0,l.w5)((()=>[(0,l._)("span",b,(0,a.zw)(o.FromProfile.name)+"　",1),(0,l._)("span",W,(0,a.zw)(o.CreatedAt),1)])),_:2},1024),(0,l.Wm)(f,{style:{"word-break":"break-all"},innerHTML:o.content,class:"q-pt-sm"},null,8,["innerHTML"])])),_:2},1024),(0,l._)("div",q,[e.logged?((0,l.wg)(),(0,l.j4)(d,{key:0,size:"10px",round:"",flat:"",color:"primary",icon:"comment",onClick:t=>e.commentss(n,null)},null,8,["onClick"])):(0,l.kq)("",!0),(0,l.Wm)(d,{size:"10px",round:"",flat:"",color:0==o.DiggArr.length?"#ccc":"red",icon:"favorite",onClick:t=>e.favorite(n,null,o.ID)},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{color:0==o.DiggArr.length?"#ccc":"orange",rounded:"",floating:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(o.digg),1)])),_:2},1032,["color"])])),_:2},1032,["color","onClick"])])])),_:2},1024),o.isshow?((0,l.wg)(),(0,l.iD)("div",D,[(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{rounded:""},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.meinfo.avatar},null,8,A)])),_:1})])),_:1}),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(m,{autogrow:"",modelValue:e.childtext,"onUpdate:modelValue":t[2]||(t[2]=t=>e.childtext=t),label:"回复："+o.FromProfile.name,dense:e.dense},{after:(0,l.w5)((()=>[(0,l.Wm)(d,{flat:"",round:"",color:"primary",icon:"mood"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{"max-width":"250px",style:{padding:"4px 8px"},self:"top start",cover:"false"},{default:(0,l.w5)((()=>[(0,l._)("div",Z,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.faceList,((t,o)=>((0,l.wg)(),(0,l.iD)("a",{href:"javascript:void(0);",onClick:t=>e.getEmo1(o),style:{"font-size":"22px","text-decoration":"none"},key:o,class:"emotionItem"},(0,a.zw)(t),9,Q)))),128))])])),_:1})])),_:1}),(0,l.Wm)(d,{flat:"",class:"text-weight-bolder",color:"primary",onClick:t=>e.addComment(o.ID),label:"Comment"},null,8,["onClick"])])),_:2},1032,["modelValue","label","dense"])])),_:2},1024)])),_:2},1024)])):(0,l.kq)("",!0),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.CommentChild,((o,i)=>((0,l.wg)(),(0,l.j4)(U,{class:"q-mx-lg",key:i},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{class:"q-pa-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{class:"cursor-pointer",onClick:t=>e.toRepositories(o.FromProfile.id),rounded:""},{default:(0,l.w5)((()=>[(0,l._)("img",{alt:"avatar",src:o.FromProfile.avatar},null,8,z)])),_:2},1032,["onClick"])])),_:2},1024),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(f,{lines:"1"},{default:(0,l.w5)((()=>[(0,l._)("span",I,(0,a.zw)(o.FromProfile.name),1),S,(0,l._)("span",H,(0,a.zw)(o.ToProfile.name),1)])),_:2},1024),(0,l.Wm)(f,{style:{"word-break":"break-all"},innerHTML:o.content},null,8,["innerHTML"])])),_:2},1024),(0,l._)("div",Y,[e.logged?((0,l.wg)(),(0,l.j4)(d,{key:0,size:"10px",round:"",flat:"",color:"primary",icon:"comment",onClick:t=>e.commentss(n,i)},null,8,["onClick"])):(0,l.kq)("",!0),(0,l.Wm)(d,{size:"10px",round:"",flat:"",color:0==o.DiggArr.length?"#ccc":"red",icon:"favorite",onClick:t=>e.favorite(n,i,o.ID)},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{color:0==o.DiggArr.length?"#ccc":"orange",rounded:"",floating:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(o.digg),1)])),_:2},1032,["color"])])),_:2},1032,["color","onClick"])])])),_:2},1024),o.isshow?((0,l.wg)(),(0,l.iD)("div",j,[(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{rounded:""},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.meinfo.avatar},null,8,P)])),_:1})])),_:1}),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(m,{autogrow:"",modelValue:e.childtext,"onUpdate:modelValue":t[3]||(t[3]=t=>e.childtext=t),label:"回复："+o.ToProfile.name,dense:e.dense},{after:(0,l.w5)((()=>[(0,l.Wm)(d,{flat:"",round:"",color:"primary",icon:"mood"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{"max-width":"250px",style:{padding:"4px 8px"},self:"top start",cover:"false"},{default:(0,l.w5)((()=>[(0,l._)("div",T,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.faceList,((t,o)=>((0,l.wg)(),(0,l.iD)("a",{href:"javascript:void(0);",onClick:t=>e.getEmo1(o),style:{"font-size":"22px","text-decoration":"none"},key:o,class:"emotionItem"},(0,a.zw)(t),9,$)))),128))])])),_:2},1024)])),_:2},1024),(0,l.Wm)(d,{flat:"",color:"primary",class:"text-weight-bolder",onClick:t=>e.addComment(o.ID),label:"Comment"},null,8,["onClick"])])),_:2},1032,["modelValue","label","dense"])])),_:2},1024)])),_:2},1024)])):(0,l.kq)("",!0)])),_:2},1024)))),128))])),_:2},1024)))),128)),L])}var E=o(78114),U=o(80589),M=o(64434),R=o(21082),K=o(10011),V=o(43359),B=o(79582);const N={name:"Comment",components:{},props:{idss:{type:String,required:!0}},setup(){let e=(0,f.qj)({meinfo:{},logged:!1,marktext:"",faceList:[],text:"",childtext:"",isshow:!1,isfav:!1,isshowindex:0,isshowindex1:0,comments:[]});const t=(0,B.yj)(),o=(0,B.tv)(),a={commentss(t,o){e.childtext="",null==o?(0!=e.comments[e.isshowindex].CommentChild.length&&(e.comments[e.isshowindex].CommentChild[e.isshowindex1].isshow=!1),e.comments[e.isshowindex].isshow=!1,e.comments[t].isshow=!0,e.isshowindex=t):(e.comments[e.isshowindex].CommentChild[e.isshowindex1].isshow=!1,e.comments[e.isshowindex].isshow=!1,e.comments[t].CommentChild[o].isshow=!0,e.isshowindex=t,e.isshowindex1=o)},toRepositories(e){o.push(`/repository/${e}`)},async favorite(t,o,l){const a={comment_id:l};if(null==o)if(0==e.comments[t].DiggArr.length){let o=await(0,K.sh)(a);200==o.status&&(e.comments[t].DiggArr[0]=!0,e.comments[t].digg++)}else{let o=await(0,K.uc)(a);200==o.status&&(e.comments[t].DiggArr=[],e.comments[t].digg--)}else if(0==e.comments[t].CommentChild[o].DiggArr.length){let l=await(0,K.sh)(a);200==l.status&&(e.comments[t].CommentChild[o].DiggArr[0]=!0,e.comments[t].CommentChild[o].digg++)}else{let l=await(0,K.uc)(a);200==l.status&&(e.comments[t].CommentChild[o].DiggArr=[],e.comments[t].CommentChild[o].digg--)}},async getTalk(){"yes"===U.Z.getItem("logged_in")&&(e.logged=!0);const o={pagenum:1,pagesize:10};let l=await(0,V.nQ)(t.params.id,o);null!=l.data&&(e.comments=l.data.map((e=>{e.isshow=!1;let t=new Date(e.CreatedAt),o=R.ZP.formatDate(t,"YYYY-MM-DD HH:mm:ss");e.CreatedAt=o;const l=e.CommentChild;return null!=l&&0!=l.length&&l.forEach((e=>{e.isshow=!1;let t=new Date(e.CreatedAt),o=R.ZP.formatDate(t,"YYYY-MM-DD HH:mm:ss");e.CreatedAt=o})),e})))},async addComment(o){let l={article_id:1e3*t.params.id/1e3,content:e.text,comment_id:0};if(0!=o?(l.content=e.childtext,l.comment_id=o):delete l.comment_id,""==l.content)return void M.Z.create({message:"comment can't be empty",color:"negative",icon:"report_problem",position:"top",timeout:2e3});let n=await(0,K.Ir)(l);200==n.status&&(e.text="",e.childtext=""),await a.getTalk()},getEmo(t){const o=e.faceList[t];e.text=e.text+o},getEmo1(t){const o=e.faceList[t];e.childtext=e.childtext+o},async getEmo2(){}};return(0,l.bv)((async()=>{e.meinfo.avatar=U.Z.getItem("avatar"),await a.getTalk(),E.forEach((t=>{e.faceList.push(t.char)}))})),{...(0,f.BK)(e),...a}}};var O=o(74260),G=o(64689),J=o(75096),X=o(2165),ee=o(61289),te=o(83944),oe=o(10151),le=o(25589),ae=o(27011),ne=o(83414),ie=o(52035),se=o(2350),re=o(69721),ce=o(24554),de=o(7518),me=o.n(de);const ue=(0,O.Z)(N,[["render",F]]),pe=ue;me()(N,"components",{QInput:G.Z,QAvatar:J.Z,QBtn:X.Z,QPopupEdit:ee.Z,QPopupProxy:te.Z,QCard:oe.Z,QCardSection:le.Z,QList:ae.Z,QItem:ne.Z,QItemSection:ie.Z,QItemLabel:se.Z,QBadge:re.Z,QIcon:ce.Z});const ge={name:"Post",components:{Comment:pe},setup(){const e=(0,B.yj)(),t=(0,B.tv)();let o=(0,f.qj)({onload:!1,post:{id:"",title:"",CreatedAt:"",viewCount:"",content:"",profile:null,favour:0,FavourArr:[]},titles:[],isActive:!0,closetitle:null});const a=(0,f.iH)(null),n=(0,f.iH)(null),i={async commentss(){let t=await(0,K.fq)(e.params.id);o.onload=!0,o.post.content=t.data.content,o.post.id=t.data.ID,o.post.title=t.data.title;let l=new Date(t.data.CreatedAt),a=R.ZP.formatDate(l,"YYYY-MM-DD HH:mm:ss");o.post.CreatedAt=a,o.post.viewCount=t.data.view_count,o.post.profile=t.data.Profile,o.post.favour=t.data.favour,o.post.FavourArr=t.data.FavourArr},toRepositories(e){t.push(`/repository/${e}`)},handleAnchorClick(e){const{lineIndex:t}=e,o=a.value.$el.querySelector(`[data-v-md-line="${String(t)}"]`);o&&a.value.scrollToTarget({target:o,scrollContainer:window,top:60})},processTitles(){const e=a.value.$el.querySelectorAll("h1,h2,h3,h4,h5,h6"),t=Array.from(e).filter((e=>!!e.innerText.trim()));if(!t.length)return void(o.titles=[]);const l=Array.from(new Set(t.map((e=>e.tagName)))).sort();o.titles=t.map((e=>({title:e.innerText,lineIndex:e.getAttribute("data-v-md-line"),indent:l.indexOf(e.tagName),top:e.offsetTop}))),console.log(o.titles)},async favorite(){const e={article_id:parseInt(o.post.id)};if(0==o.post.FavourArr.length){let t=await(0,K.iA)(e);200==t.status&&(o.post.FavourArr[0]=!0,o.post.favour++)}else{let t=await(0,K.Rf)(e);200==t.status&&(o.post.FavourArr=[],o.post.favour--)}}};return(0,l.bv)((async()=>{await i.commentss(),await(0,l.Y3)((()=>{let e=0;const t=a.value.$el.querySelectorAll("img");console.log(t),t.forEach((o=>{o.complete?(e++,e===t.length&&i.processTitles()):(o.addEventListener("load",(()=>{e++,e===t.length&&i.processTitles()})),o.addEventListener("error",(()=>{console.error("图片加载失败:",o.src),e++,e===t.length&&i.processTitles()})))})),t.length||i.processTitles()}))})),{...(0,f.BK)(o),...i,previewRef:a,titleRef:n,onScroll(e){var t=Number(e.position.top)+12;if(o.titles.forEach((e=>{const l=n.value.$el.querySelector(`.line${String(e.lineIndex)}`);l.style.backgroundColor="",t>=e.top&&(o.closetitle=e)})),o.closetitle){const e=n.value.$el.querySelector(`.line${String(o.closetitle.lineIndex)}`);e.style.backgroundColor="#d2eaf9"}}}}};var we=o(24379),fe=o(54103),he=o(4303),ve=o(67030),xe=o(65869);const _e=(0,O.Z)(ge,[["render",w]]),ye=_e;me()(ge,"components",{QPage:we.Z,QBtn:X.Z,QBadge:re.Z,QItem:ne.Z,QItemSection:ie.Z,QAvatar:J.Z,QItemLabel:se.Z,QIcon:ce.Z,QSkeleton:fe.ZP,QScrollObserver:he.Z,QChip:ve.Z,QSeparator:xe.Z,QCard:oe.Z,QCardSection:le.Z})}}]);